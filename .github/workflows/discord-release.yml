name: Discord Release Notification

on:
  release:
    types: [published, prereleased]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Beta Channel Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          RELEASE_NAME="${{ github.event.release.name }}"
          RELEASE_TAG="${{ github.event.release.tag_name }}"
          RELEASE_URL="${{ github.event.release.html_url }}"
          DOWNLOAD_URL="https://github.com/${{ github.repository }}/releases/download/${RELEASE_TAG}/EVONLauncher.exe"

          cat > payload.json << 'EOFPAYLOAD'
          {
            "username": "EVON Beta",
            "avatar_url": "https://raw.githubusercontent.com/Cosmic4796/evon-releases/main/icon.png",
            "embeds": [{
              "title": "TITLE_PLACEHOLDER",
              "url": "URL_PLACEHOLDER",
              "description": "A new beta version is available for premium users!

**Download EVONLauncher.exe to get started.**",
              "color": 5814783,
              "fields": [
                {
                  "name": "Download",
                  "value": "[EVONLauncher.exe](DOWNLOAD_PLACEHOLDER)",
                  "inline": true
                },
                {
                  "name": "Version",
                  "value": "TAG_PLACEHOLDER",
                  "inline": true
                }
              ],
              "footer": {
                "text": "EVON Beta - Premium Early Access"
              }
            }]
          }
          EOFPAYLOAD

          sed -i "s|TITLE_PLACEHOLDER|${RELEASE_NAME}|g" payload.json
          sed -i "s|URL_PLACEHOLDER|${RELEASE_URL}|g" payload.json
          sed -i "s|DOWNLOAD_PLACEHOLDER|${DOWNLOAD_URL}|g" payload.json
          sed -i "s|TAG_PLACEHOLDER|${RELEASE_TAG}|g" payload.json

          curl -s -H "Content-Type: application/json" -d @payload.json $DISCORD_WEBHOOK
          echo "Beta notification sent!"

      - name: Send Main Channel Teaser
        env:
          DISCORD_WEBHOOK_MAIN: ${{ secrets.DISCORD_WEBHOOK_MAIN }}
        run: |
          cat > teaser.json << 'EOFTEASER'
          {
            "username": "EVON Updates",
            "avatar_url": "https://raw.githubusercontent.com/Cosmic4796/evon-releases/main/icon.png",
            "embeds": [{
              "title": "New Hotfixes and Features in Development!",
              "description": "We have been working on some exciting updates including bug fixes and performance improvements.

**Want early access?** Premium members get beta releases before everyone else!",
              "color": 15844367,
              "fields": [
                {
                  "name": "Get Premium",
                  "value": "Purchase the EVON gamepass for early access to new features!",
                  "inline": false
                }
              ],
              "footer": {
                "text": "EVON Obfuscator - Coming Soon to Everyone"
              }
            }]
          }
          EOFTEASER
          curl -s -H "Content-Type: application/json" -d @teaser.json $DISCORD_WEBHOOK_MAIN
          echo "Main channel teaser sent!"
